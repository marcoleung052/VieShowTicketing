<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="pageTitle">é›»å½±è³‡è¨Š - Vieshow Ticketing</title> 
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* è‡ªå®šç¾©æ¨£å¼ */
        .detail-row {
            display: flex;
            align-items: baseline;
            margin-bottom: 0.75rem; /* space-y-3 */
        }
        .detail-label {
            font-weight: 600; /* font-semibold */
            width: 80px; /* å›ºå®šå¯¬åº¦ï¼Œæ–¹ä¾¿å°é½Š */
            flex-shrink: 0;
            color: #374151; /* gray-700 */
        }
        .detail-content {
            flex-grow: 1;
        }
        .showtime-card {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .showtime-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
    </style>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'vieshow-red': '#e50914',
                        'vieshow-gold': '#f7a83d',
                    },
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans TC', 'sans-serif'],
                    },
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100 font-sans min-h-screen flex flex-col">
    
    <header class="bg-gray-800 text-white shadow-md">
        <nav class="container mx-auto px-4 py-4 flex justify-between items-center">
            <a href="../../index.html" class="text-xl font-bold hover:text-vieshow-red transition duration-300">Vieshow å½±åŸ</a>
            <div id="headerNavRight" class="space-x-4">
            </div>
        </nav>
    </header>

    <div class="container mx-auto px-4 py-8 flex-grow">
        <div id="movieInfoCard" class="bg-white p-6 md:p-10 rounded-xl shadow-lg">
            
            <h2 id="movieTitle" class="text-3xl font-extrabold text-vieshow-red mb-3 border-b-4 border-vieshow-red pb-3 text-center">
                </h2>
            
            <div id="averageRatingDisplay" class="text-center mb-8 p-4 bg-red-50 rounded-lg shadow-inner border border-red-200">
                </div>

            <div class="movie-details mb-8 text-gray-700 bg-gray-50 p-6 rounded-xl border border-gray-200">
                <h3 class="text-xl font-bold mb-4 text-gray-800 border-b pb-2">åŸºæœ¬è³‡è¨Š</h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-3">
                    <div class="detail-row"><span class="detail-label">ä¸Šæ˜ æ™‚é–“:</span><span id="releaseTime" class="detail-content"></span></div>
                    <div class="detail-row"><span class="detail-label">é¡å‹:</span><span id="genre" class="detail-content"></span></div>
                    <div class="detail-row"><span class="detail-label">ç‰‡é•·:</span><span id="duration" class="detail-content"></span></div>
                    <div class="detail-row"><span class="detail-label">å°æ¼”:</span><span id="director" class="detail-content"></span></div>
                    <div class="detail-row"><span class="detail-label">æ¼”å“¡:</span><span id="cast" class="detail-content"></span></div>
                </div>
                
                <h3 class="text-xl font-bold mt-6 mb-2 text-gray-800 border-b pb-2">åŠ‡æƒ…ç°¡ä»‹:</h3>
                <p id="synopsis" class="leading-relaxed whitespace-pre-wrap"></p>
            </div>

            <div id="ratingWrapper" class="mb-8 border border-dashed border-gray-300 p-6 rounded-lg bg-yellow-50">
                <h4 class="text-xl font-semibold mb-4 text-gray-800">æ‚¨çš„è©•åˆ† (éœ€ç™»å…¥æ‰èƒ½åƒèˆ‡)</h4>
                
                <div id="ratingSection">
                    </div>
            </div>
            
            <div id="bookingButtonWrapper" class="text-center pt-4"> 
                <a href="../booking/booking_flow_1.html" 
                    class="inline-block px-8 py-3 bg-vieshow-red text-white font-bold rounded-full shadow-lg hover:bg-red-700 transition duration-300 transform hover:scale-[1.02]">
                    ğŸŸï¸ å‰å¾€è¨‚ç¥¨
                </a>
            </div>
        </div>
    </div>

    <footer class="bg-gray-800 text-white text-center py-4 mt-8 shadow-inner">
        <p>&copy; 2025 Vieshow Ticketing System</p>
    </footer>

    <script>
        // ----------------------------------------------------
        // æ¨¡æ“¬ PHP å¾Œç«¯è¡Œç‚º: å–å¾— URL åƒæ•¸å’Œç™»å…¥ç‹€æ…‹
        // ----------------------------------------------------
        
        /**
         * å‹•æ…‹æª¢æŸ¥æ¨¡æ“¬çš„ç™»å…¥ç‹€æ…‹
         * @returns {boolean} - true: å·²ç™»å…¥, false: æœªç™»å…¥
         */
        function checkSimulatedLoginStatus() {
            // æª¢æŸ¥ localStorage ä¸­æ˜¯å¦æœ‰æ¨¡æ“¬çš„ç™»å…¥ token
            const token = localStorage.getItem('auth_token');
            // å¦‚æœ token å­˜åœ¨ï¼Œå‰‡è¦–ç‚ºå·²ç™»å…¥
            return !!token; 
        }
        
        // å–å¾— URL åƒæ•¸ä¸­çš„ movie_id
        function getQueryParam(param) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        }

        const movieID = getQueryParam('movie_id') || 'G001'; // é è¨­å€¼
        
        // ----------------------------------------------------
        // å°è¦½åˆ—ç›¸é—œçš„è·¯å¾‘å®šç¾© (æ–°å¢)
        // ----------------------------------------------------
        const LOGIN_PAGE_URL = '../auth/login.html'; // å¾ movie ç›®éŒ„å›åˆ° pages/auth/login.html
        const MEMBER_HOME_URL = '../member/member_home.html'; // å¾ movie ç›®éŒ„å›åˆ° pages/member/member_home.html


        // ----------------------------------------------------
        // æ¨¡æ“¬é›»å½±å®Œæ•´è³‡æ–™ (åŒ…å«å¹³å‡è©•åˆ†)
        // ----------------------------------------------------
        // æ³¨æ„ï¼šreleaseTime è¨­ç‚ºæœªä¾†æ—¥æœŸ "2099-12-01" æ¨¡æ“¬æœªä¸Šæ˜ 
        const mockMovieData = {
            id: movieID,
            name: "æ˜Ÿéš›ç‰¹æ”»éšŠï¼šç„¡é™æˆ°çˆ­",
            releaseTime: "2025-12-01", 
            director: "è‰¾ç‘å…‹Â·é™³ (Eric Chen)",
            cast: "å…‹é‡Œæ–¯Â·æ½˜, æ½”è¥¿å¡Â·è¯æ£®, æ¹¯å§†Â·æ",
            genre: "ç§‘å¹» / å‹•ä½œ / å†’éšª",
            duration: "155 åˆ†é˜",
            synopsis: "è¥¿å…ƒ 2242 å¹´ï¼Œå®‡å®™è¯é‚¦é­é‡ä¾†è‡ªé»‘æš—è±¡é™çš„æœªçŸ¥å¨è„…ã€‚ä¸€åè¢«æ”¾é€çš„å‰ç‰¹å·¥éšŠå“¡ï¼Œæ„å¤–ç™¼ç¾äº†å•Ÿå‹•å¤ä»£æ­¦å™¨çš„é—œéµå¯†ç¢¼ã€‚ä»–å¿…é ˆèˆ‡ä¸€æ”¯ç”±äººå·¥æ™ºæ…§ã€å›é€†å·¥ç¨‹å¸«å’Œå¤–æ˜Ÿè³é‡‘çµäººçµ„æˆçš„é›œç‰Œè»åˆä½œï¼Œåœ¨å®‡å®™å…¨é¢å´©æ½°å‰ï¼Œå®Œæˆé€™å ´ä¸å¯èƒ½çš„æˆ°çˆ­ã€‚",
            // æ–°å¢å¹³å‡è©•åˆ†æ¬„ä½ (å…¬é–‹è³‡è¨Š)
            averageRating: 4.2, 
            totalVotes: 1289,
            showtimes: [] // å ´æ¬¡è³‡æ–™ç¾åœ¨å·²ç„¡éœ€æ¸²æŸ“
        };

        // ----------------------------------------------------
        // è¼”åŠ©å‡½å¼ï¼šæª¢æŸ¥é›»å½±æ˜¯å¦å·²ä¸Šæ˜ 
        // ----------------------------------------------------
        /**
         * æª¢æŸ¥é›»å½±æ˜¯å¦å·²ä¸Šæ˜ ï¼ˆä¸Šæ˜ æ—¥ <= ä»Šå¤©ï¼‰
         * @param {string} releaseDateString - é›»å½±ä¸Šæ˜ æ—¥æœŸ (YYYY-MM-DD)
         * @returns {boolean} - true: å·²ä¸Šæ˜ , false: æœªä¸Šæ˜ 
         */
        function isMovieReleased(releaseDateString) {
            const today = new Date();
            // å°‡æ™‚é–“éƒ¨åˆ†æ­¸é›¶ï¼Œåªæ¯”è¼ƒæ—¥æœŸ
            today.setHours(0, 0, 0, 0); 
                    
            const releaseDate = new Date(releaseDateString);
            releaseDate.setHours(0, 0, 0, 0); 
                    
            // å¦‚æœä¸Šæ˜ æ—¥æœŸåœ¨ä»Šå¤©æˆ–ä»Šå¤©ä¹‹å‰ï¼Œå‰‡è¦–ç‚ºå·²ä¸Šæ˜ 
            return releaseDate <= today;
        }
        
        // ----------------------------------------------------
        // å°è¦½åˆ—å‹•æ…‹æ¸²æŸ“å‡½å¼ (æ–°å¢)
        // ----------------------------------------------------

        /**
         * æ¸²æŸ“æœªç™»å…¥ç‹€æ…‹çš„å°è¦½åˆ—ã€‚
         */
        function renderLoggedOutState() {
            const headerNavRight = document.getElementById('headerNavRight');
            if (!headerNavRight) return;
            
            // ç²å–ç•¶å‰é é¢çš„å®Œæ•´ URLï¼Œä¸¦é€²è¡Œ URL ç·¨ç¢¼
            const currentUrl = encodeURIComponent(window.location.href);

            // æ§‹é€ å¸¶æœ‰å›èª¿ç¶²å€çš„ç™»å…¥é€£çµ
            const loginRedirectUrl = `${LOGIN_PAGE_URL}?redirect=${currentUrl}`;
            
            // æ¸²æŸ“å°è¦½åˆ—ï¼šç™»å…¥ + æœƒå“¡ä¸­å¿ƒ
            headerNavRight.innerHTML = `
                <a href="${loginRedirectUrl}" class="hover:text-vieshow-gold transition duration-300">ç™»å…¥</a>
                <a href="${MEMBER_HOME_URL}" class="hover:text-vieshow-gold transition duration-300">æœƒå“¡ä¸­å¿ƒ</a>
            `;
        }

        /**
         * æ¸²æŸ“å·²ç™»å…¥ç‹€æ…‹çš„å°è¦½åˆ—ã€‚
         */
        function renderLoggedInState() {
            const headerNavRight = document.getElementById('headerNavRight');
            if (!headerNavRight) return;

            // æ¸²æŸ“å°è¦½åˆ—ï¼šç™»å‡º + æœƒå“¡ä¸­å¿ƒ
            headerNavRight.innerHTML = `
                <a href="#" id="signOutLink" class="hover:text-vieshow-gold transition duration-300">ç™»å‡º</a>
                <a href="${MEMBER_HOME_URL}" class="hover:text-vieshow-gold transition duration-300">æœƒå“¡ä¸­å¿ƒ</a>
            `;
            
            // ç¶å®šç™»å‡ºäº‹ä»¶
            document.getElementById('signOutLink')?.addEventListener('click', handleSignOut);
        }

        /**
         * è™•ç†ç™»å‡ºé‚è¼¯
         */
        function handleSignOut(e) {
            e.preventDefault();

            // 1. æ¸…é™¤ç™»å…¥ç‹€æ…‹çš„é—œéµæ­¥é©Ÿ
            localStorage.removeItem('auth_token');

            // 2. é¡¯ç¤ºç™»å‡ºè¨Šæ¯ (ä½¿ç”¨è‡ªå®šç¾© alert)
            // å°‡è·³è½‰é‚è¼¯ä½œç‚ºå›å‘¼å‡½æ•¸å‚³å…¥
            // alert('æ‚¨å·²æˆåŠŸç™»å‡ºã€‚å³å°‡å°å‘é¦–é ...', () => {
            //     // 3. å»¶é²å°å‘é¦–é  (åœ¨ç”¨æˆ¶é»æ“Š Modal ç¢ºèªå¾Œ 2 ç§’åŸ·è¡Œ)
            //     setTimeout(() => {
            //         window.location.href = INDEX_PAGE_URL;
            //     }, 2000);
            // }); 
            alert('æ‚¨å·²æˆåŠŸç™»å‡ºã€‚å³å°‡é‡æ–°æ•´ç†é é¢...', () => {
                // 3. å»¶é²å°å‘ç•¶å‰é é¢
                setTimeout(() => {
                    // *** é—œéµä¿®æ­£ï¼šé‡æ–°è¼‰å…¥ç•¶å‰é é¢ï¼Œè€Œä¸æ˜¯è·³å›é¦–é  ***
                    window.location.href = window.location.href; 
                }, 2000);
            });
            
            // 4. é‡æ–°æ¸²æŸ“å°è¦½åˆ—è‡³æœªç™»å…¥ç‹€æ…‹ (å¿…é ˆåœ¨è·³è½‰å‰åŸ·è¡Œ)
            renderUI();
        }

        /**
         * æª¢æŸ¥ç™»å…¥ç‹€æ…‹ä¸¦æ¸²æŸ“å°è¦½åˆ— UI
         */
        function renderUI() {
            // æ¨¡æ“¬ï¼šå¦‚æœ localStorage ä¸­æœ‰ 'auth_token' å‰‡è¦–ç‚ºå·²ç™»å…¥
            const token = localStorage.getItem('auth_token');
            if (token) {
                // ç”±æ–¼é€™è£¡æ˜¯å¿«æœé ï¼Œæˆ‘å€‘æ¨¡æ“¬ç”¨æˆ¶åç¨±
                renderLoggedInState(); 
            } else {
                renderLoggedOutState();
            }
        }
        
        // ----------------------------------------------------
        // æ¸²æŸ“ä¸»è¦é é¢å…§å®¹å‡½å¼
        // ----------------------------------------------------

        /**
         * æ¸²æŸ“é›»å½±åŸºæœ¬è³‡è¨Šã€åŠ‡æƒ…ç°¡ä»‹å’Œå¹³å‡è©•åˆ†
         * @param {object} movie - é›»å½±è³‡æ–™ç‰©ä»¶
         */
        function renderMovieInfo(movie, isReleased) {
            // è¨­ç½®é é¢æ¨™é¡Œå’Œä¸»æ¨™é¡Œ
            const fullTitle = `ã€Š${movie.name}ã€‹é›»å½±è³‡è¨Š`;
            document.getElementById('pageTitle').textContent = fullTitle;
            document.getElementById('movieTitle').textContent = `ã€Š${movie.name}ã€‹é›»å½±ä»‹ç´¹`;

            // å¡«å……è©³ç´°è³‡è¨Š
            document.getElementById('releaseTime').textContent = movie.releaseTime;
            document.getElementById('director').textContent = movie.director;
            document.getElementById('cast').textContent = movie.cast;
            document.getElementById('genre').textContent = movie.genre;
            document.getElementById('duration').textContent = movie.duration;
            document.getElementById('synopsis').textContent = movie.synopsis;

            // æ¸²æŸ“å¹³å‡è©•åˆ† (å…¬é–‹è³‡è¨Š)
            const ratingDisplay = document.getElementById('averageRatingDisplay');
            const bookingButtonWrapper = document.getElementById('bookingButtonWrapper'); 

            if (isReleased) {
                ratingDisplay.innerHTML = `
                    <p class="text-xl font-semibold text-gray-800 flex items-center justify-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-vieshow-gold mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.817 2.045a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.817-2.045a1 1 0 00-1.175 0l-2.817 2.045c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.02 8.729c-.783-.57-.381-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                        </svg>
                        å¹³å‡è§€çœ¾è©•åˆ†ï¼š
                        <span class="text-vieshow-red text-4xl font-extrabold ml-2">${movie.averageRating.toFixed(1)}</span> / 5.0
                    </p>
                    <p class="text-sm text-gray-500 mt-1">
                        (ä¾†è‡ª ${movie.totalVotes.toLocaleString()} ä½è§€çœ¾)
                    </p>
                `;
                // ç¢ºä¿è¨‚ç¥¨æŒ‰éˆ•æ˜¯å¯ç”¨çš„é€£çµ
                if (bookingButtonWrapper) {
                    bookingButtonWrapper.innerHTML = `
                        <a href="../booking/booking_flow_1.html" 
                            class="inline-block px-8 py-3 bg-vieshow-red text-white font-bold rounded-full shadow-lg hover:bg-red-700 transition duration-300 transform hover:scale-[1.02]">
                            ğŸŸï¸ å‰å¾€è¨‚ç¥¨
                        </a>`;
                }
            } else {
                ratingDisplay.textContent = "æ­¤é›»å½±å°šæœªä¸Šæ˜ ï¼Œæš«ç„¡è©•åˆ†è³‡æ–™ã€‚";
                // æ›¿æ›è¨‚ç¥¨æŒ‰éˆ•ç‚ºç¦ç”¨ç‹€æ…‹
                if (bookingButtonWrapper) {
                    bookingButtonWrapper.innerHTML = `
                        <button disabled class="inline-block px-8 py-3 bg-gray-400 text-white font-bold rounded-full shadow-lg cursor-not-allowed">
                            ğŸŸï¸ å°šæœªé–‹æ”¾è¨‚ç¥¨
                        </button>
                    `;
                }
            }
        }

        /**
         * æ ¹æ“šç™»å…¥ç‹€æ…‹æ¸²æŸ“å€‹äººè©•åˆ†/æäº¤å€å¡Š (éœ€ç™»å…¥)
         * @param {boolean} isLoggedIn - ä½¿ç”¨è€…æ˜¯å¦ç™»å…¥
         * @param {string} movieId - ç•¶å‰é›»å½± ID
         */
        function renderRatingSection(isLoggedIn, movieId, isReleased) {
            const ratingWrapper = document.getElementById('ratingWrapper'); 
            const ratingSection = document.getElementById('ratingSection');
            let content = '';
            
            if (!isReleased) {
                // æœªä¸Šæ˜ ï¼šéš±è—æ•´å€‹é»ƒè‰²è©•åˆ†å€å¡Š
                if (ratingWrapper) {
                    ratingWrapper.classList.add('hidden');
                }
                return; // ç›´æ¥çµæŸå‡½å¼
            } else {
                // å·²ä¸Šæ˜ ï¼šç¢ºä¿å€å¡Šé¡¯ç¤º
                if (ratingWrapper) {
                    ratingWrapper.classList.remove('hidden');
                }
            }
            
            if (isLoggedIn) {
                // å·²ç™»å…¥ï¼šé¡¯ç¤ºè©•åˆ†è¡¨å–®
                content = `
                    <form id="ratingForm" action="#" method="POST" class="flex flex-col sm:flex-row items-start sm:items-center space-y-3 sm:space-y-0 sm:space-x-4">
                        <input type="hidden" name="movie_id" value="${movieId}">
                        
                        <select name="rating" class="p-2 border border-gray-300 rounded-md shadow-sm focus:ring-vieshow-gold focus:border-vieshow-gold w-full sm:w-auto">
                            <option value="5">â­â­â­â­â­ 5 é¡†æ˜Ÿ (æ¥µä½³)</option>
                            <option value="4">â­â­â­â­ 4 é¡†æ˜Ÿ</option>
                            <option value="3" selected>â­â­â­ 3 é¡†æ˜Ÿ (å°šå¯)</option>
                            <option value="2">â­â­ 2 é¡†æ˜Ÿ</option>
                            <option value="1">â­ 1 é¡†æ˜Ÿ (æ¥µå·®)</option>
                        </select>
                        
                        <button type="submit" 
                                class="submit-rating-button bg-vieshow-gold text-gray-900 font-semibold py-2 px-4 rounded-md shadow-md hover:bg-yellow-500 transition duration-300 w-full sm:w-auto">
                            é€å‡ºè©•åˆ†
                        </button>
                    </form>
                `;
                
                // è™•ç†è¡¨å–®æäº¤ï¼ˆæ¨¡æ“¬ï¼‰
                setTimeout(() => {
                    const form = document.getElementById('ratingForm');
                    if (form) {
                        form.addEventListener('submit', (e) => {
                            e.preventDefault();
                            
                            // 1. å–å¾—ç”¨æˆ¶è©•åˆ†
                            const newRating = parseInt(e.target.rating.value); // å–å¾—ç”¨æˆ¶é¸æ“‡çš„æ˜Ÿæ˜Ÿæ•¸ (1-5)
                            const submitButton = e.target.querySelector('.submit-rating-button');

                            // æ¨¡æ“¬æäº¤ä¸­çš„ç‹€æ…‹
                            submitButton.textContent = 'æäº¤ä¸­...';
                            submitButton.disabled = true;

                            // æ¨¡æ“¬ç¶²è·¯å»¶é²å’Œå¾Œç«¯è™•ç†
                            setTimeout(() => {
                                
                                // 2. è¨ˆç®—æ–°çš„å¹³å‡è©•åˆ†å’Œç¸½æŠ•ç¥¨æ•¸
                                const currentTotalVotes = mockMovieData.totalVotes;
                                const currentAverageRating = mockMovieData.averageRating;
                                
                                // è¨ˆç®—ç¸½åˆ†æ•¸ (èˆŠç¸½åˆ† = èˆŠå¹³å‡ * èˆŠç¥¨æ•¸)
                                const oldTotalScore = currentAverageRating * currentTotalVotes;
                                
                                // è¨ˆç®—æ–°çš„ç¸½åˆ†æ•¸å’Œç¸½ç¥¨æ•¸
                                const newTotalVotes = currentTotalVotes + 1;
                                const newTotalScore = oldTotalScore + newRating;
                                const newAverageRating = newTotalScore / newTotalVotes;

                                // æ›´æ–°æ¨¡æ“¬è³‡æ–™ç‰©ä»¶
                                mockMovieData.averageRating = newAverageRating;
                                mockMovieData.totalVotes = newTotalVotes;

                                // 3. å‘¼å« renderMovieInfo é‡æ–°æ¸²æŸ“ç•«é¢
                                // é‡æ–°æ¸²æŸ“é›»å½±è³‡è¨Š (æ›´æ–°å¹³å‡åˆ†æ•¸)
                                renderMovieInfo(mockMovieData, isReleased);
                                // æç¤ºæˆåŠŸ
                                alertMessage(`è©•åˆ†æˆåŠŸï¼æ‚¨çµ¦äº† ${newRating} é¡†æ˜Ÿã€‚å¹³å‡åˆ†å·²æ›´æ–°ç‚º ${newAverageRating.toFixed(1)}ã€‚`, 'success');
                                
                                // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹ (ä¸¦æ¨¡æ“¬ç”¨æˆ¶ä¸èƒ½é‡è¤‡è©•åˆ†ï¼Œæ‰€ä»¥ç›´æ¥ç¦ç”¨)
                                submitButton.textContent = 'å·²è©•åˆ†';
                                submitButton.classList.remove('bg-vieshow-gold', 'hover:bg-yellow-500');
                                submitButton.classList.add('bg-gray-400', 'cursor-not-allowed');
                                
                            }, 1000); // æ¨¡æ“¬ 1 ç§’å¾Œç«¯è™•ç†æ™‚é–“
                        });
                    }
                }, 0);

            } else {
                // æœªç™»å…¥ï¼šé¡¯ç¤ºç™»å…¥æç¤º (åªæœ‰åœ¨æœªç™»å…¥æ™‚æ‰é¡¯ç¤º)
                content = `
                    <p class="text-gray-600 mb-4 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-600 mr-2" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M8.257 4.966a1.5 1.5 0 012.486 0l1.243 2.056c.14.232.408.384.7.384h2.522c.866 0 1.228 1.133.585 1.644l-2.035 1.57c-.244.188-.389.48-.389.782l.777 2.404c.26.804-.616 1.487-1.282.936l-2.035-1.57c-.244-.188-.59-.188-.834 0l-2.035 1.57c-.666.551-1.542-.132-1.282-.936l.777-2.404c.007-.02.012-.04.017-.06H5.207c-.866 0-1.228-1.133-.585-1.644l2.035-1.57c.244-.188.389-.48.389-.782l-.777-2.404z" clip-rule="evenodd" />
                        </svg>
                        æ‚¨å°šæœªç™»å…¥ï¼Œè«‹å…ˆç™»å…¥å¾Œæ‰èƒ½ç‚ºé›»å½±è©•åˆ†ã€‚
                    </p>
                    <a href="${LOGIN_PAGE_URL_INFO}" 
                        class="btn-action bg-vieshow-gold text-gray-900 font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-yellow-500 transition duration-300 inline-flex items-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                        </svg>
                        <span>ğŸ‘¤ å‰å¾€ç™»å…¥</span>
                    </a>
                `;
            }

            ratingSection.innerHTML = content;
        }
        
        // æ¨¡æ“¬è‡ªå®šç¾© Alert è¨Šæ¯ï¼ˆå–ä»£ window.alertï¼‰
        function alertMessage(message, type = 'info') {
            const body = document.body;
            let existingAlert = document.getElementById('customAlert');
            if (existingAlert) existingAlert.remove();

            const alertDiv = document.createElement('div');
            alertDiv.id = 'customAlert';
            alertDiv.className = `fixed top-5 left-1/2 transform -translate-x-1/2 p-4 rounded-lg shadow-xl text-white font-bold z-50 transition-opacity duration-300 ${type === 'success' ? 'bg-green-600' : 'bg-blue-600'}`;
            alertDiv.textContent = message;
            
            body.appendChild(alertDiv);
            
            // è‡ªå‹•æ¶ˆå¤±
            setTimeout(() => {
                alertDiv.classList.add('opacity-0');
                setTimeout(() => alertDiv.remove(), 300);
            }, 3000);
        }

        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            // *** ä¿®æ­£å¾Œæ–°å¢ï¼šå…ˆæ¸²æŸ“å°è¦½åˆ— UI ***
            renderUI(); 
            
            // æ¥è‘—åŸ·è¡Œé›»å½±è³‡è¨Šå’Œè©•åˆ†å€å¡Šçš„æ¸²æŸ“
            const IS_LOGGED_IN_DYNAMIC = checkSimulatedLoginStatus(); 
            const IS_RELEASED = isMovieReleased(mockMovieData.releaseTime); 
                    
            renderMovieInfo(mockMovieData, IS_RELEASED); 
            renderRatingSection(IS_LOGGED_IN_DYNAMIC, mockMovieData.id, IS_RELEASED); 
        });

        function alert(message, callback) {
            const existingModal = document.getElementById('custom-alert-modal');
            if (existingModal) existingModal.remove();

            // è™•ç†é»æ“Šã€Œç¢ºèªã€çš„é‚è¼¯
            const handleConfirm = () => {
                document.getElementById('custom-alert-modal').remove();
                if (callback && typeof callback === 'function') {
                    // **åªæœ‰åœ¨ç”¨æˆ¶é»æ“Šç¢ºèªå¾Œï¼Œæ‰åŸ·è¡Œå‚³å…¥çš„ callback å‡½æ•¸ (ä¾‹å¦‚ç™»å‡ºå¾Œçš„è·³è½‰)**
                    callback(); 
                }
            };
            
            // å°‡ handleConfirm å‡½æ•¸è¨»å†Šåˆ°å…¨åŸŸï¼Œä»¥ä¾¿åœ¨ HTML onclick ä¸­ä½¿ç”¨
            window.customAlertConfirm = handleConfirm;

            const modalHtml = `
                <div id="custom-alert-modal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50">
                    <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-sm transform scale-100 transition-all duration-300">
                        <div class="text-xl font-bold text-gray-900 mb-3 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-vieshow-red mr-2" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd" />
                            </svg>
                            ç³»çµ±æç¤º
                        </div>
                        <p class="text-gray-700 mb-5">${message}</p>
                        <div class="flex justify-end">
                            <button onclick="window.customAlertConfirm()" 
                                    class="bg-vieshow-red hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-lg transition duration-200 focus:outline-none focus:ring-2 focus:ring-vieshow-red focus:ring-offset-2">
                                ç¢ºèª
                            </button>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

    </script>
    
</body>
</html>