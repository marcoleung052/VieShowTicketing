<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿˜è¨˜å¯†ç¢¼ - Vieshow Ticketing</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'vieshow-red': '#e50914',
                        'vieshow-gold': '#f7a83d',
                    },
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans TC', 'sans-serif'],
                    },
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50 font-sans min-h-screen flex flex-col items-center justify-center p-4">
    
    <div class="w-full max-w-sm">
        
        <div class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-vieshow-red">Vieshow</h1>
            <p class="text-gray-600 mt-1">å¨ç§€å½±åŸè¨‚ç¥¨ç³»çµ±</p>
        </div>

        <div class="bg-white p-6 sm:p-8 rounded-xl shadow-2xl border-t-4 border-vieshow-red">
            <h2 class="text-2xl font-bold text-gray-800 mb-2 text-center">
                ğŸ”’ é‡è¨­å¯†ç¢¼
            </h2>
            <div id="messageContainer" class="hidden p-3 mb-4 rounded-lg font-medium text-sm text-center" role="alert"></div>
            
            <div id="step1_verification">
                <p class="text-center text-gray-500 mb-6 text-sm">è«‹è¼¸å…¥æ‚¨çš„å¸³è™Ÿèˆ‡èº«åˆ†è­‰è™Ÿé€²è¡Œé©—è­‰ã€‚</p>
                <form id="verificationForm" action="#" method="POST" class="space-y-4">
                    <div>
                        <label for="memberEmail" class="block text-sm font-medium text-gray-700 mb-1">é›»å­éƒµä»¶ (å¸³è™Ÿ):</label>
                        <input type="email" id="memberEmail" name="memberEmail" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-vieshow-red focus:border-vieshow-red transition duration-150" placeholder="æ‚¨çš„è¨»å†Šé›»å­éƒµä»¶">
                    </div>
                    <div>
                        <label for="memberId" class="block text-sm font-medium text-gray-700 mb-1">èº«åˆ†è­‰å­—è™Ÿ:</label>
                        <input type="text" id="memberId" name="memberId" required maxlength="10" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-vieshow-red focus:border-vieshow-red transition duration-150" placeholder="è«‹è¼¸å…¥èº«åˆ†è­‰å­—è™Ÿ (10ç¢¼)">
                    </div>
                    <button type="submit" id="step1Button" class="w-full bg-vieshow-red text-white py-3 rounded-lg font-bold text-base hover:bg-red-700 transition duration-200 shadow-md flex items-center justify-center">
                        é©—è­‰å¸³è™Ÿ
                    </button>
                </form>
            </div>

            <div id="step2_reset" class="hidden">
                <p class="text-center text-gray-500 mb-6 text-sm">è«‹è¼¸å…¥ä¸¦ç¢ºèªæ–°çš„å¯†ç¢¼ã€‚</p>
                <form id="resetPasswordForm" action="#" method="POST" class="space-y-4">
                    <div>
                        <label for="newPassword" class="block text-sm font-medium text-gray-700 mb-1">æ–°å¯†ç¢¼ (è‹±æ•¸çµ„åˆï¼Œè‡³å°‘8ç¢¼):</label>
                        <input type="password" id="newPassword" name="newPassword" required minlength="8" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-vieshow-red focus:border-vieshow-red transition duration-150" placeholder="è«‹è¼¸å…¥ 8 ä½ä»¥ä¸Šæ–°å¯†ç¢¼">
                        <span class="text-vieshow-red text-xs mt-1 block" id="newPwdFormatError"></span>
                    </div>
                    <div>
                        <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-1">ç¢ºèªæ–°å¯†ç¢¼:</label>
                        <input type="password" id="confirmPassword" name="confirmPassword" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-vieshow-red focus:border-vieshow-red transition duration-150" placeholder="è«‹å†æ¬¡è¼¸å…¥æ–°å¯†ç¢¼">
                        <span class="text-vieshow-red text-xs mt-1 block" id="newPwdMatchError"></span>
                    </div>
                    <button type="submit" id="step2Button" class="w-full bg-vieshow-red text-white py-3 rounded-lg font-bold text-base hover:bg-red-700 transition duration-200 shadow-md flex items-center justify-center">
                        ç¢ºèªæ›´æ”¹å¯†ç¢¼
                    </button>
                </form>
            </div>
            
            <p class="mt-6 text-center text-sm">
                <a href="#" id="backToLoginLink" class="text-blue-600 hover:text-blue-800 hover:underline transition duration-150">
                    &larr; è¿”å›
                </a>
            </p>
        </div>
    </div>

    <script>
        // --- åµæ¸¬å›è·³ç¶²å€é‚è¼¯ ---
        let targetLoginUrl = 'login.html'; // é è¨­ç™»å…¥é é¢

        // å–å¾—ç¶²å€çš„æŸ¥è©¢åƒæ•¸
        const urlParams = new URLSearchParams(window.location.search);
        const redirectUrl = urlParams.get('redirect'); // å–å¾—åç‚º 'redirect' çš„åƒæ•¸å€¼

        if (redirectUrl) {
            try {
                // å¦‚æœæœ‰ redirect åƒæ•¸ï¼Œå‰‡ä½¿ç”¨è©²ç¶²å€ (éœ€è¦è§£ç¢¼)
                targetLoginUrl = decodeURIComponent(redirectUrl);
                console.log("åµæ¸¬åˆ°å›èª¿ç¶²å€:", targetLoginUrl);
            } catch (e) {
                console.error("è§£ç¢¼ redirect ç¶²å€æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œä½¿ç”¨é è¨­ç¶²å€ã€‚", e);
                // è§£ç¢¼å¤±æ•—æ™‚ï¼Œä»ä½¿ç”¨é è¨­ç¶²å€
            }
        } else {
            console.log("æœªåµæ¸¬åˆ°å›èª¿ç¶²å€ï¼Œä½¿ç”¨é è¨­ç™»å…¥é é¢:", targetLoginUrl);
        }
        
        /**
         * é¡¯ç¤ºè¡¨å–®æ“ä½œè¨Šæ¯
         * @param {string} text - å…§æ–‡
         * @param {string} type - è¨Šæ¯é¡å‹ ('success', 'error', 'info')
         */
        function showFormMessage(text, type) {
            const container = document.getElementById('messageContainer');
            container.textContent = text;
            container.classList.remove('hidden', 'bg-green-100', 'text-green-800', 'bg-red-100', 'text-red-800', 'bg-blue-100', 'text-blue-800');
            
            if (type === 'success') {
                container.classList.add('bg-green-100', 'text-green-800');
            } else if (type === 'error') {
                container.classList.add('bg-red-100', 'text-red-800');
            } else if (type === 'info') {
                 container.classList.add('bg-blue-100', 'text-blue-800');
            }

            // 5ç§’å¾Œè‡ªå‹•éš±è—
            setTimeout(() => {
                container.classList.add('hidden');
            }, 5000);
        }

        /**
         * æª¢æŸ¥å¯†ç¢¼æ ¼å¼ï¼šè‹±æ•¸çµ„åˆä¸”è‡³å°‘8å€‹å­—å…ƒ (èˆ‡è¨»å†Šé é¢çµ±ä¸€)
         * @param {string} password - å¯†ç¢¼
         * @returns {string | null} - éŒ¯èª¤è¨Šæ¯æˆ– null (æ ¼å¼æ­£ç¢º)
         */
        function checkPasswordFormat(password) {
            if (password.length < 8) {
                return 'å¯†ç¢¼é•·åº¦å¿…é ˆè‡³å°‘ 8 å€‹å­—å…ƒã€‚';
            }
            if (!/[a-zA-Z]/.test(password)) {
                return 'å¯†ç¢¼å¿…é ˆåŒ…å«è‹±æ–‡å­—æ¯ã€‚';
            }
            if (!/[0-9]/.test(password)) {
                return 'å¯†ç¢¼å¿…é ˆåŒ…å«æ•¸å­—ã€‚';
            }
            return null; // æ ¼å¼æ­£ç¢º
        }


        const step1 = document.getElementById('step1_verification');
        const step2 = document.getElementById('step2_reset');
        const verificationForm = document.getElementById('verificationForm');
        const resetForm = document.getElementById('resetPasswordForm');
        const step1Button = document.getElementById('step1Button');
        const step2Button = document.getElementById('step2Button');

        // éŒ¯èª¤è¨Šæ¯å…ƒç´ 
        const newPwdFormatError = document.getElementById('newPwdFormatError');
        const newPwdMatchError = document.getElementById('newPwdMatchError');
        
        // æ¸…ç©ºæ‰€æœ‰å…§è¯éŒ¯èª¤æç¤º
        function clearResetErrors() {
            newPwdFormatError.textContent = '';
            newPwdMatchError.textContent = '';
        }
        
        // --- æ­¥é©Ÿä¸€ï¼šå¸³è™Ÿé©—è­‰è™•ç† (ä¿æŒä¸è®Š) ---
        verificationForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('memberEmail').value;
            const id = document.getElementById('memberId').value;
            
            // ç”±æ–¼é€™ä¸æ˜¯èº«åˆ†è­‰æ ¼å¼é©—è­‰ï¼Œåªåšé•·åº¦æª¢æŸ¥å³å¯
            if (id.length !== 10) {
                showFormMessage('âŒ èº«åˆ†è­‰å­—è™Ÿé•·åº¦å¿…é ˆæ˜¯ 10 ç¢¼ã€‚', 'error');
                return;
            }

            step1Button.disabled = true;
            step1Button.textContent = 'é©—è­‰ä¸­...';
            step1Button.classList.add('opacity-75', 'cursor-not-allowed');
            showFormMessage('æ­£åœ¨é©—è­‰æ‚¨çš„å¸³è™Ÿå’Œèº«åˆ†è³‡è¨Š...', 'info');
            
            // æ¨¡æ“¬ç•°æ­¥ API è«‹æ±‚ (é©—è­‰)
            setTimeout(() => {
                // å‡è¨­æˆåŠŸæ¢ä»¶ï¼šEmail ç‚º test@vieshow.com ä¸”èº«åˆ†è­‰è™Ÿç‚º A123456789
                const success = (email === 'test@vieshow.com' && id.toUpperCase() === 'A123456789'); 
                
                if (success) {
                    showFormMessage('âœ… å¸³è™Ÿé©—è­‰æˆåŠŸï¼è«‹è¨­å®šæ‚¨çš„æ–°å¯†ç¢¼ã€‚', 'success');
                    
                    // åˆ‡æ›åˆ°æ­¥é©ŸäºŒ
                    step1.classList.add('hidden');
                    step2.classList.remove('hidden');
                } else {
                    // æ¨¡æ“¬å¤±æ•—å›è¦†
                    showFormMessage('âŒ å¸³è™Ÿæˆ–èº«åˆ†è­‰å­—è™Ÿä¸ç¬¦ï¼Œè«‹ç¢ºèªè¼¸å…¥æ˜¯å¦æ­£ç¢ºã€‚', 'error');
                }

                step1Button.disabled = false;
                step1Button.textContent = 'é©—è­‰å¸³è™Ÿ';
                step1Button.classList.remove('opacity-75', 'cursor-not-allowed');
            }, 2000); // æ¨¡æ“¬ 2 ç§’å»¶é²
        });

        // --- æ­¥é©ŸäºŒï¼šé‡è¨­å¯†ç¢¼è™•ç† (å·²ä¿®æ­£) ---
        resetForm.addEventListener('submit', function(e) {
            e.preventDefault();

            clearResetErrors(); // æ¸…ç©ºä¸Šæ¬¡çš„éŒ¯èª¤æç¤º

            const newPass = document.getElementById('newPassword').value;
            const confirmPass = document.getElementById('confirmPassword').value;

            // 1. å¯†ç¢¼æ ¼å¼æª¢æŸ¥ (çµ±ä¸€è¦å‰‡)
            const formatError = checkPasswordFormat(newPass);
            if (formatError) {
                newPwdFormatError.textContent = 'âŒ ' + formatError;
                showFormMessage('âŒ æ–°å¯†ç¢¼ä¸ç¬¦åˆæ ¼å¼è¦æ±‚ã€‚', 'error');
                return;
            }

            // 2. å¯†ç¢¼ç¢ºèªæª¢æŸ¥
            if (newPass !== confirmPass) {
                newPwdMatchError.textContent = 'âŒ å…©æ¬¡è¼¸å…¥çš„æ–°å¯†ç¢¼ä¸ä¸€è‡´ï¼Œè«‹é‡æ–°ç¢ºèªã€‚';
                showFormMessage('âŒ å…©æ¬¡è¼¸å…¥çš„æ–°å¯†ç¢¼ä¸ä¸€è‡´ã€‚', 'error');
                return;
            }

            // é©—è­‰é€šéï¼ŒåŸ·è¡Œæäº¤
            step2Button.disabled = true;
            step2Button.textContent = 'æ­£åœ¨æ›´æ”¹å¯†ç¢¼...';
            step2Button.classList.add('opacity-75', 'cursor-not-allowed');

            showFormMessage('æ­£åœ¨ç‚ºæ‚¨æ›´æ–°å¯†ç¢¼ï¼Œè«‹ç¨å€™...', 'info');

            // æ¨¡æ“¬ç•°æ­¥ API è«‹æ±‚ (æ›´æ–°å¯†ç¢¼)
            setTimeout(() => {
                // å‡è¨­æ›´æ–°å¯†ç¢¼ç¸½æ˜¯æˆåŠŸ
                showFormMessage(`ğŸ‰ å¯†ç¢¼å·²æˆåŠŸæ›´æ–°ï¼æ‚¨å¯ä»¥ä½¿ç”¨æ–°å¯†ç¢¼ç™»å…¥äº†ã€‚`, 'success');
                
                // æ›´æ”¹æˆåŠŸå¾Œï¼Œæ¸…ç©ºæ¬„ä½ä¸¦å°å‘ç™»å…¥é é¢ (æ¨¡æ“¬)
                resetForm.reset();
                step2Button.textContent = 'å·²æˆåŠŸæ›´æ”¹';
                
                // æ¨¡æ“¬ 2 ç§’å¾Œè·³è½‰åˆ°ç™»å…¥é é¢
                setTimeout(() => {
                    // window.location.href = 'login.html'; // å‡è¨­ç™»å…¥é é¢æ˜¯ login.html
                    window.location.href = targetLoginUrl;
                }, 2000);
                
            }, 2000); // æ¨¡æ“¬ 2 ç§’å»¶é²
        });

        // --- åœ¨é é¢è¼‰å…¥æ™‚ï¼Œå°‡é€£çµçš„ href è¨­å®šç‚ºåµæ¸¬åˆ°çš„ç›®æ¨™ç¶²å€ ---
        // ç¢ºä¿åœ¨ DOM è¼‰å…¥å¾ŒåŸ·è¡Œæ­¤æ“ä½œ
        document.addEventListener('DOMContentLoaded', () => {
            const backLink = document.getElementById('backToLoginLink');
            if (backLink) {
                backLink.href = targetLoginUrl;
            }
        });
    </script>
    
</body>
</html>