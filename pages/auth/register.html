<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœƒå“¡è¨»å†Š - Vieshow Ticketing</title> 
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script>
        // Tailwind é…ç½®
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'vieshow-red': '#e50914',
                        'vieshow-gold': '#f7a83d',
                        'success-green': '#10b981', 
                    },
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans TC', 'sans-serif'],
                    },
                    boxShadow: {
                        'vieshow': '0 10px 15px -3px rgba(229, 9, 20, 0.1), 0 4px 6px -2px rgba(229, 9, 20, 0.05)',
                    }
                }
            }
        }
    </script>
<script src="../../js/chatbot.js"></script>
    <style>
        @keyframes fadeInDown {
            from { opacity: 0; transform: translate(-50%, -40px); }
            to { opacity: 1; transform: translate(-50%, 20px); }
        }
        @keyframes fadeOutUp {
            from { opacity: 1; transform: translate(-50%, 20px); }
            to { opacity: 0; transform: translate(-50%, -40px); }
        }
        .animate-fade-in-down { animation: fadeInDown 0.5s ease-out forwards; }
        .animate-fade-out-up { animation: fadeOutUp 0.5s ease-in forwards; }

        .min-h-screen { min-height: 100vh; }
        .register-card { display: none; max-width: 44rem; }
        .register-card:first-child { display: block; }
    </style>
</head>
<body class="bg-gray-50 font-sans min-h-screen flex flex-col">
    
    <header class="bg-gray-800 text-white shadow-md">
        <nav class="container mx-auto px-4 py-4 flex justify-between items-center">
            <a href="../../index.html" class="text-xl font-bold hover:text-vieshow-red transition duration-300">Vieshow å½±åŸ</a>
        </nav>
    </header>

    <div id="notification" class="fixed top-0 left-1/2 -translate-x-1/2 z-50 p-4 rounded-lg shadow-xl text-white opacity-0 pointer-events-none transition-all duration-300" role="alert">
    </div>

    <main class="container mx-auto px-4 py-8 flex-grow flex items-center justify-center">
        
        <div id="registerCard" class="register-card w-full max-w-xl bg-white p-6 sm:p-10 rounded-2xl shadow-2xl border-t-8 border-vieshow-red transform transition-transform duration-300">
            
            <h2 class="text-3xl font-extrabold text-gray-900 mb-8 text-center border-b pb-4 border-vieshow-red/50">
                æœƒå“¡è¨»å†Š
            </h2>

            <form id="registerForm" class="space-y-6">
                
                <div>
                    <label for="memberCardID" class="block text-sm font-medium text-gray-700 mb-1">èº«åˆ†è­‰å­—è™Ÿ:</label>
                    <div class="flex space-x-3">
                        <input type="text" id="memberCardID" name="memberCardID" required maxlength="10"
                            class="flex-grow p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-vieshow-red focus:border-vieshow-red transition duration-200 shadow-sm uppercase"
                            placeholder="è«‹è¼¸å…¥èº«åˆ†è­‰å­—è™Ÿ (10 ç¢¼)">
                        
                        <button type="button" id="checkIdButton"
                            class="shrink-0 px-4 py-2 text-sm font-medium rounded-xl bg-gray-200 text-gray-700 hover:bg-vieshow-gold hover:text-white transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                            æª¢æŸ¥æ ¼å¼
                        </button>
                    </div>
                    <span class="error text-vieshow-red text-xs mt-1 block" id="idError"></span>
                </div>

                <div><label for="memberName" class="block text-sm font-medium text-gray-700 mb-1">å§“å:</label><input type="text" id="memberName" name="memberName" required class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-vieshow-red focus:border-vieshow-red transition duration-200 shadow-sm" placeholder="è«‹è¼¸å…¥çœŸå¯¦å§“å"></div>
                <div><label for="memberBirth" class="block text-sm font-medium text-gray-700 mb-1">ç”Ÿæ—¥:</label><input type="date" id="memberBirth" name="memberBirth" required class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-vieshow-red focus:border-vieshow-red transition duration-200 shadow-sm"></div>

                <div>
                    <label for="memberPhone" class="block text-sm font-medium text-gray-700 mb-1">è¡Œå‹•é›»è©±:</label>
                    <input type="tel" id="memberPhone" name="memberPhone" required pattern="09\d{8}" maxlength="10"
                        class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-vieshow-red focus:border-vieshow-red transition duration-200 shadow-sm"
                        placeholder="ä¾‹å¦‚: 0912345678">
                    <input type="tel" id="memberPhoneConfirm" name="memberPhoneConfirm" required maxlength="10"
                        class="w-full p-3 mt-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-vieshow-red focus:border-vieshow-red transition duration-200 shadow-sm"
                        placeholder="å†æ¬¡è¼¸å…¥è¡Œå‹•é›»è©±">
                    <span class="error text-vieshow-red text-xs mt-1 block" id="phoneMatchError"></span>
                </div>

                <div>
                    <label for="memberEmail" class="block text-sm font-medium text-gray-700 mb-1">é›»å­éƒµä»¶ (Email):</label>
                    <input type="email" id="memberEmail" name="memberEmail" required
                        class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-vieshow-red focus:border-vieshow-red transition duration-200 shadow-sm"
                        placeholder="è«‹è¼¸å…¥é›»å­éƒµä»¶">
                    <input type="email" id="memberEmailConfirm" name="memberEmailConfirm" required
                        class="w-full p-3 mt-2 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-vieshow-red focus:border-vieshow-red transition duration-200 shadow-sm"
                        placeholder="å†æ¬¡è¼¸å…¥é›»å­éƒµä»¶">
                    <span class="error text-vieshow-red text-xs mt-1 block" id="emailMatchError"></span>
                    <span class="error text-vieshow-red text-xs mt-1 block" id="emailError"></span>
                </div>

                <div>
                    <label for="memberPwd" class="block text-sm font-medium text-gray-700 mb-1">å¯†ç¢¼ (è‹±æ•¸çµ„åˆï¼Œè‡³å°‘8ç¢¼):</label>
                    <input type="password" id="memberPwd" name="memberPwd" required minlength="8"
                        class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-vieshow-red focus:border-vieshow-red transition duration-200 shadow-sm"
                        placeholder="è¨­å®šæ‚¨çš„å¯†ç¢¼">
                    <span class="error text-vieshow-red text-xs mt-1 block" id="pwdFormatError"></span>
                </div>

                <div>
                    <label for="memberPwdConfirm" class="block text-sm font-medium text-gray-700 mb-1">ç¢ºèªå¯†ç¢¼:</label>
                    <input type="password" id="memberPwdConfirm" name="memberPwdConfirm" required
                        class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-vieshow-red focus:border-vieshow-red transition duration-200 shadow-sm"
                        placeholder="å†æ¬¡è¼¸å…¥å¯†ç¢¼">
                    <span class="error text-vieshow-red text-xs mt-1 block" id="pwdMatchError"></span>
                </div>
                
                <button type="submit" id="registerButton"
                    class="w-full bg-vieshow-red hover:bg-red-700 text-white font-bold py-3 rounded-xl transition duration-300 shadow-lg hover:shadow-xl hover:shadow-vieshow-red/40 transform hover:-translate-y-0.5 mt-8">
                    ä¸‹ä¸€æ­¥ï¼šç™¼é€å•Ÿç”¨ä¿¡ä»¶
                </button>

                <p class="text-center text-sm text-gray-600 mt-4">
                    å·²æ˜¯æœƒå“¡ï¼Ÿ <a href="login.html" class="text-vieshow-red font-semibold hover:text-vieshow-gold transition duration-300 hover:underline">ç«‹å³ç™»å…¥</a>
                </p>
            </form>
        </div>

        <div id="activationCard" class="register-card w-full max-w-lg bg-white p-6 sm:p-10 rounded-2xl shadow-2xl border-t-8 border-vieshow-gold hidden">
            <h2 class="text-3xl font-extrabold text-gray-900 mb-8 text-center border-b pb-4 border-vieshow-gold/50">
                å¸³è™Ÿå•Ÿç”¨
            </h2>
            <div class="space-y-4 text-center">
                <p class="text-lg text-gray-700">æˆ‘å€‘å·²å°‡ä¸€çµ„ 4 ä½æ•¸å­—ç¢ºèªç¢¼å¯„é€è‡³æ‚¨çš„é›»å­éƒµä»¶ä¿¡ç®±ï¼š</p>
                <p id="sentEmailDisplay" class="text-vieshow-red font-bold text-xl"></p>
                
                <form id="activationForm" class="space-y-4">
                    <label for="activationCode" class="block text-sm font-medium text-gray-700 pt-4">è¼¸å…¥ç¢ºèªç¢¼:</label>
                    <input type="text" id="activationCode" name="activationCode" required maxlength="4"
                        class="w-full max-w-xs mx-auto text-center p-3 border-2 border-vieshow-gold rounded-xl text-2xl tracking-widest focus:outline-none focus:ring-2 focus:ring-vieshow-gold transition duration-200 shadow-md">
                    <span class="error text-vieshow-red text-xs mt-1 block" id="activationError"></span>
                    <div id="simulatedCodeDisplay" class="text-2xl font-extrabold text-vieshow-gold bg-yellow-100/50 border border-vieshow-gold p-3 rounded-lg mx-auto w-fit tracking-widest">
                        <span class="text-sm font-normal text-gray-500 mr-2">ç¢ºèªç¢¼:</span> <span id="theCode">----</span>
                    </div>
                    <div class="flex flex-col space-y-3 pt-6">
                        <button type="submit"
                            class="bg-success-green hover:bg-green-700 text-white font-bold py-3 rounded-xl transition duration-300 shadow-lg transform hover:-translate-y-0.5">
                            ç¢ºèªä¸¦å•Ÿç”¨å¸³è™Ÿ
                        </button>
                        <button type="button" id="resendCode" class="text-sm text-gray-500 hover:text-vieshow-red transition duration-300">
                            é‡æ–°ç™¼é€ç¢ºèªç¢¼
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div id="successCard" class="register-card w-full max-w-xl bg-white p-6 sm:p-10 rounded-2xl shadow-2xl border-t-8 border-success-green hidden">
            <h2 class="text-3xl font-extrabold text-success-green mb-6 text-center">
                ğŸ‰ è¨»å†ŠæˆåŠŸï¼
            </h2>
            <p class="text-center text-gray-700 mb-8">æ­å–œæ‚¨æˆç‚º Vieshow æœƒå“¡ã€‚ä»¥ä¸‹æ˜¯æ‚¨çš„è¨»å†Šè³‡æ–™ï¼š</p>

            <div id="confirmationDetails" class="space-y-4 bg-gray-50 p-6 rounded-lg border">
            </div>

            <button id="goToLogin"
                class="w-full bg-vieshow-red hover:bg-red-700 text-white font-bold py-3 rounded-xl transition duration-300 shadow-lg mt-8 transform hover:-translate-y-0.5">
                å‰å¾€ç™»å…¥é é¢
            </button>
        </div>

    </main>

    <footer class="bg-gray-800 text-white p-4 mt-auto text-center text-sm">
        <p class="text-gray-400">&copy; 2025 Vieshow Ticketing System.</p>
    </footer>

    <script>
        // 1. è¨­å®šå¾Œç«¯ API ç¶²å€
        const API_BASE_URL = 'https://marcoleung052-vieshow-backend.hf.space/api';
        
        let currentActivationCode = ''; 
        let memberData = {}; 
        let isIdChecked = false; 
        
        // --- è¼”åŠ©å‡½æ•¸ ---
        let notificationTimeout;
        function showNotification(message, type = 'error', duration = 3000) {
            const notification = document.getElementById('notification');
            clearTimeout(notificationTimeout);

            notification.className = 'fixed top-0 left-1/2 -translate-x-1/2 z-50 p-4 rounded-lg shadow-xl text-white pointer-events-none';
            if (type === 'success') {
                notification.classList.add('bg-green-600');
            } else if (type === 'warning') {
                notification.classList.add('bg-vieshow-gold');
            } else {
                notification.classList.add('bg-vieshow-red');
            }

            notification.innerHTML = `<strong>${type === 'success' ? 'âœ”' : (type === 'warning' ? 'âš ï¸' : 'âŒ')}</strong> ${message}`;
            
            notification.classList.remove('opacity-0', 'animate-fade-out-up');
            notification.classList.add('animate-fade-in-down');

            notificationTimeout = setTimeout(() => {
                notification.classList.remove('animate-fade-in-down');
                notification.classList.add('animate-fade-out-up');
            }, duration);
        }

        // èº«åˆ†è­‰æ ¼å¼æª¢æŸ¥ (ä¿æŒä¸è®Š)
        function isValidTwId(id) {
            const regex = /^[A-Z][12]\d{8}$/;
            if (!regex.test(id)) return false;

            const map = 'ABCDEFGHJKLMNPQRSTUVXYWZIO';
            const char = id.charAt(0);
            const index = map.indexOf(char) + 10;
            
            const n1 = Math.floor(index / 10);
            const n2 = index % 10;
            let sum = n1 * 1 + n2 * 9;

            for (let i = 1; i <= 8; i++) {
                sum += parseInt(id.charAt(i)) * (9 - i);
            }
            sum += parseInt(id.charAt(9)) * 1;
            
            return sum % 10 === 0;
        }

        // å¯†ç¢¼æ ¼å¼æª¢æŸ¥ (ä¿æŒä¸è®Š)
        function checkPasswordFormat(password) {
            if (password.length < 8) return 'å¯†ç¢¼å¿…é ˆè‡³å°‘ 8 å€‹å­—å…ƒã€‚';
            if (!/[a-zA-Z]/.test(password)) return 'å¯†ç¢¼å¿…é ˆåŒ…å«è‹±æ–‡å­—æ¯ã€‚';
            if (!/[0-9]/.test(password)) return 'å¯†ç¢¼å¿…é ˆåŒ…å«æ•¸å­—ã€‚';
            return null; 
        }

        function generateActivationCode() {
            return Math.floor(1000 + Math.random() * 9000).toString();
        }
        
        // â˜…â˜…â˜… æ–°å¢ï¼šæ›´æ–°æ¨¡æ“¬ç¢¼é¡¯ç¤ºå€å¡Šçš„å‡½å¼ â˜…â˜…â˜…
        function updateSimulatedCodeDisplay() {
            const codeEl = document.getElementById('theCode');
            if (codeEl) {
                codeEl.textContent = currentActivationCode;
            }
        }

        function showCard(cardId) {
            document.querySelectorAll('.register-card').forEach(card => {
                card.style.display = 'none';
            });
            document.getElementById(cardId).style.display = 'block';
            window.scrollTo(0, 0); 
        }

        // --- ç¨ç«‹æª¢æŸ¥èº«åˆ†è­‰ (ç´”å‰ç«¯æ ¼å¼é©—è­‰) --- (ä¿æŒä¸è®Š)
        async function checkIdCard() {
            const checkBtn = document.getElementById('checkIdButton');
            const idInput = document.getElementById('memberCardID');
            const idError = document.getElementById('idError');
            const idCard = idInput.value.trim().toUpperCase();
            
            // é‡ç½®ç‹€æ…‹
            idError.textContent = '';
            idError.classList.remove('text-success-green');
            idError.classList.add('text-vieshow-red');
            isIdChecked = false;
            
            // 1. æœ¬åœ°æ ¼å¼é©—è­‰
            if (idCard.length !== 10) {
                idError.textContent = 'èº«åˆ†è­‰è™Ÿå¿…é ˆç‚º 10 ç¢¼ã€‚';
                showNotification('èº«åˆ†è­‰è™Ÿç¢¼é•·åº¦éŒ¯èª¤ã€‚', 'error');
                return;
            }

            if (!isValidTwId(idCard)) {
                idError.textContent = 'æ­¤è­‰è™Ÿæ ¼å¼ä¸æ­£ç¢ºï¼Œè«‹æª¢æŸ¥è¼¸å…¥ã€‚';
                showNotification('èº«åˆ†è­‰æ ¼å¼é©—è­‰å¤±æ•—ã€‚', 'error');
                return;
            }
            
            // 2. å‘¼å«å¾Œç«¯ API æª¢æŸ¥é‡è¤‡
            checkBtn.disabled = true;
            checkBtn.textContent = 'æª¢æŸ¥ä¸­...';
            
            try {
                const response = await fetch(`${API_BASE_URL}/auth/check-id`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ idCard: idCard })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    // é€šéæª¢æŸ¥
                    idError.textContent = 'âœ… é©—è­‰é€šéï¼Œæ­¤å¸³è™Ÿå¯è¨»å†Š';
                    idError.classList.remove('text-vieshow-red');
                    idError.classList.add('text-success-green');
                    isIdChecked = true;
                    showNotification('èº«åˆ†è­‰é©—è­‰æˆåŠŸï¼', 'success');
                } else {
                    // é‡è¤‡è¨»å†Š
                    idError.textContent = `âŒ ${result.message}`;
                    showNotification(result.message, 'error');
                }
            } catch (e) {
                console.error(e);
                idError.textContent = 'âŒ ç„¡æ³•é€£ç·šè‡³ä¼ºæœå™¨æª¢æŸ¥';
                showNotification('ä¼ºæœå™¨é€£ç·šéŒ¯èª¤', 'error');
            } finally {
                checkBtn.disabled = false;
                checkBtn.textContent = 'æª¢æŸ¥æ ¼å¼';
            }
        }


        // --- è™•ç†è¨»å†Šè¡¨å–®æäº¤ (å‘¼å« API) ---
        document.getElementById('registerForm').addEventListener('submit', async function(event) {
            event.preventDefault(); 

            // æ¸…é™¤éŒ¯èª¤è¨Šæ¯
            document.querySelectorAll('.error:not(#idError)').forEach(el => el.textContent = '');
            
            if (!isIdChecked) {
                checkIdCard(); // è‹¥æœªæª¢æŸ¥å‰‡è‡ªå‹•æª¢æŸ¥ä¸€æ¬¡
                if (!isIdChecked) return; // è‹¥æª¢æŸ¥ä»å¤±æ•—å‰‡åœæ­¢
            }

            const form = event.target;
            const requestData = {
                idCard: form.memberCardID.value.trim().toUpperCase(),
                name: form.memberName.value.trim(),
                birthDate: form.memberBirth.value,
                phone: form.memberPhone.value.trim(),
                email: form.memberEmail.value.trim(),
                password: form.memberPwd.value
            };
            const phoneConfirm = form.memberPhoneConfirm.value.trim();
            const emailConfirm = form.memberEmailConfirm.value.trim();
            const passwordConfirm = form.memberPwdConfirm.value;
            
            // --- å‰ç«¯æ¬„ä½æ¯”å°é©—è­‰ (ä¿æŒä¸è®Š) ---
            let hasError = false;
            
            if (requestData.phone !== phoneConfirm) {
                document.getElementById('phoneMatchError').textContent = 'è¡Œå‹•é›»è©±è¼¸å…¥ä¸ç›¸ç¬¦ã€‚';
                hasError = true;
            }
            if (requestData.email !== emailConfirm) {
                document.getElementById('emailMatchError').textContent = 'é›»å­éƒµä»¶è¼¸å…¥ä¸ç›¸ç¬¦ã€‚';
                hasError = true;
            }
            const pwdErrorMsg = checkPasswordFormat(requestData.password);
            if (pwdErrorMsg) {
                document.getElementById('pwdFormatError').textContent = 'å¯†ç¢¼æ ¼å¼éŒ¯èª¤ï¼š' + pwdErrorMsg;
                hasError = true;
            }
            if (requestData.password !== passwordConfirm) {
                document.getElementById('pwdMatchError').textContent = 'å¯†ç¢¼èˆ‡ç¢ºèªå¯†ç¢¼ä¸ç›¸ç¬¦ã€‚';
                hasError = true;
            }
            
            if (hasError) {
                showNotification('è«‹ä¿®æ­£è¡¨å–®ä¸­çš„éŒ¯èª¤å¾Œå†æäº¤ã€‚', 'error');
                return;
            }

            // --- å‘¼å«å¾Œç«¯ API ---
            const registerButton = document.getElementById('registerButton');
            registerButton.disabled = true;
            registerButton.textContent = 'è¨»å†Šä¸­...';

            try {
                const response = await fetch(`${API_BASE_URL}/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(requestData)
                });

                const result = await response.json();

                if (response.ok) {
                    // è¨»å†ŠæˆåŠŸ (DBå·²å»ºç«‹)
                    memberData = requestData; 
                    currentActivationCode = generateActivationCode();
                    
                    // â˜…â˜…â˜… æ›´æ–°ï¼šé¡¯ç¤ºæ¨¡æ“¬é©—è­‰ç¢¼åˆ°é é¢ä¸Š â˜…â˜…â˜…
                    updateSimulatedCodeDisplay();
                    
                    document.getElementById('sentEmailDisplay').textContent = requestData.email;
                    
                    showNotification('è³‡æ–™é©—è­‰æˆåŠŸï¼Œè«‹æŸ¥æ”¶å•Ÿç”¨ä¿¡ä»¶ (è«‹çœ‹ä¸Šæ–¹ç¢ºèªç¢¼)ã€‚', 'success', 4000);
                    showCard('activationCard');

                } else {
                    // è¨»å†Šå¤±æ•— (ä¿æŒä¸è®Š)
                    showNotification(`âŒ ${result.message}`, 'error');
                    if (result.message.includes('å·²è¨»å†Š')) {
                        if (result.message.includes('Email')) document.getElementById('emailError').textContent = result.message;
                        if (result.message.includes('èº«åˆ†è­‰')) document.getElementById('idError').textContent = result.message;
                    }
                }
            } catch (error) {
                console.error(error);
                showNotification('âŒ é€£ç·šä¼ºæœå™¨å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚', 'error');
            } finally {
                registerButton.disabled = false;
                registerButton.textContent = 'ä¸‹ä¸€æ­¥ï¼šç™¼é€å•Ÿç”¨ä¿¡ä»¶';
            }
        });

        // --- è™•ç†è¡¨å–®æäº¤ (æ­¥é©ŸäºŒ: å•Ÿç”¨ - ç´”å‰ç«¯æ¨¡æ“¬) ---
        document.getElementById('activationForm').addEventListener('submit', function(event) {
            event.preventDefault();
            
            const inputCode = document.getElementById('activationCode').value.trim();
            document.getElementById('activationError').textContent = '';

            if (inputCode === currentActivationCode) {
                showNotification('ğŸ‰ å•Ÿç”¨æˆåŠŸï¼å¸³è™Ÿå·²æ­£å¼é–‹é€šã€‚', 'success', 4000);
                displayConfirmation();
                showCard('successCard');
            } else {
                document.getElementById('activationError').textContent = 'âŒ ç¢ºèªç¢¼éŒ¯èª¤ï¼Œè«‹é‡æ–°è¼¸å…¥ã€‚';
                showNotification('âŒ å•Ÿç”¨å¤±æ•—ï¼šç¢ºèªç¢¼éŒ¯èª¤ã€‚', 'error');
                document.getElementById('activationCode').value = '';
            }
        });

        // --- é‡æ–°ç™¼é€ç¢ºèªç¢¼ ---
        document.getElementById('resendCode').addEventListener('click', function() {
            currentActivationCode = generateActivationCode();
            
            // â˜…â˜…â˜… æ›´æ–°ï¼šé¡¯ç¤ºæ–°çš„æ¨¡æ“¬é©—è­‰ç¢¼ â˜…â˜…â˜…
            updateSimulatedCodeDisplay();
            
            showNotification('æ–°çš„ç¢ºèªç¢¼å·²é‡æ–°ç™¼é€è‡³ä¿¡ç®±ã€‚', 'warning');
        });

        // --- é¡¯ç¤ºè¨»å†ŠæˆåŠŸè³‡æ–™ (æ­¥é©Ÿä¸‰) --- (ä¿æŒä¸è®Š)
        function displayConfirmation() {
            const container = document.getElementById('confirmationDetails');
            container.innerHTML = `
                <div class="flex justify-between border-b pb-2"><span class="font-medium text-gray-600">èº«åˆ†è­‰å­—è™Ÿ:</span> <span class="font-bold text-gray-800">${memberData.idCard}</span></div>
                <div class="flex justify-between border-b pb-2"><span class="font-medium text-gray-600">å§“å:</span> <span class="font-bold text-gray-800">${memberData.name}</span></div>
                <div class="flex justify-between border-b pb-2"><span class="font-medium text-gray-600">ç”Ÿæ—¥:</span> <span class="font-bold text-gray-800">${memberData.birthDate}</span></div>
                <div class="flex justify-between border-b pb-2"><span class="font-medium text-gray-600">è¡Œå‹•é›»è©±:</span> <span class="font-bold text-gray-800">${memberData.phone}</span></div>
                <div class="flex justify-between"><span class="font-medium text-gray-600">é›»å­éƒµä»¶:</span> <span class="font-bold text-gray-800">${memberData.email}</span></div>
            `;
        }
        
        document.getElementById('goToLogin').addEventListener('click', () => {
            memberData = {}; 
            currentActivationCode = '';
            window.location.href = 'login.html'; 
        });

        // --- åˆå§‹åŒ–äº‹ä»¶ç¶å®š --- (ä¿æŒä¸è®Š)
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('checkIdButton').addEventListener('click', checkIdCard);

            document.getElementById('memberCardID').addEventListener('input', () => {
                const idError = document.getElementById('idError');
                isIdChecked = false; 
                idError.textContent = ''; 
                idError.classList.remove('text-success-green');
                idError.classList.add('text-vieshow-red');
            });
        });
    </script>
</body>
</html>

